<!doctype html>
<html lang="zh" class="motion-safe:scroll-smooth 2xl:text-[20px]"> 
 <head> 
  <meta charset="utf-8"> 
  <meta name="keywords" content="Event Driven Style API Design Instead of Old Procedure Style Ones - 架构师， 架构士，架构教练, 教练, 个人成长, 组织成长, 独立顾问, architecture, book author, thinker, fighter, 架构, 思考, 技术, 武术, 哲学"> 
  <meta name="description" content="Event Driven Style API Design Instead of Old Procedure Style Ones - 福强说，扶墙老师说，王福强的个人博客， 一个架构士的思考与沉淀"> 
  <meta name="author" content="王福强"> 
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
  <meta name="robots" content="index,follow"> 
  <title>Event Driven Style API Design Instead of Old Procedure Style Ones -王福强的个人博客：一个架构士的思考与沉淀</title> 
  <meta property="og:title" content="Event Driven Style API Design Instead of Old Procedure Style Ones"> 
  <meta property="og:type" content="landing page"> 
  <meta property="og:url" content="https://afoo.me/posts/2010-07-12-prefer-event-driven-api-design.html"> 
  <meta property="og:image" content="https://og.afoo.me?url=https://afoo.me/posts/2010-07-12-prefer-event-driven-api-design.html"> 
  <meta name="twitter:card" content="summary_large_image"> 
  <meta name="twitter:title" content="Event Driven Style API Design Instead of Old Procedure Style Ones"> 
  <meta name="twitter:site" content="@afoo_me"> 
  <meta name="twitter:creator" content="@afoo_me"> 
  <meta name="twitter:image" content="https://og.afoo.me?url=https://afoo.me/posts/2010-07-12-prefer-event-driven-api-design.html"> 
  <meta name="twitter:description" content="Event Driven Style API Design Instead of Old Procedure Style Ones - 王福强的个人博客， 一个架构士的思考与沉淀"> 
  <link rel="shortcut icon" href="/favicon.ico"> 
  <link rel="canonical" href="https://afoo.me/posts/2010-07-12-prefer-event-driven-api-design.html"> 
  <link rel="icon" type="image/svg+xml" href="https://afoo.me/favicon.svg"> 
  <link rel="mask-icon" href="https://afoo.me/favicon.svg" color="#3383F8"> 
  <script src="https://unpkg.com/htmx.org@1.9.5"></script> 
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"> 
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script> 
  <script src="https://unpkg.com/@popperjs/core@2"></script> 
  <script src="https://unpkg.com/tippy.js@6"></script> 
  <link rel="stylesheet" href="/css/af.css"> 
  <link rel="stylesheet" href="/css/components.css"> 
  <link ref="stylesheet" href="/css/pygments.css"> 
  <style type="text/css">
        pre > code{
          white-space: pre-wrap;
          font-family: monospace;
          font-size: 14px;
          /* border-left: blueviolet;
          border-left-width: thick;
          border-left-style: double;
          padding-left: 1rem !important; */
        }
        
        .x-indicator{
            display:none;
        }
        .htmx-request .x-indicator{
            display:inline;
        }
        .htmx-request.x-indicator{
            display:inline;
        }
    </style> 
  <style type="text/css">
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ff0000; font-weight: bold; } /* Alert */
      code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #7d9029; } /* Attribute */
      code span.bn { color: #40a070; } /* BaseN */
      code span.bu { color: #008000; } /* BuiltIn */
      code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4070a0; } /* Char */
      code span.cn { color: #880000; } /* Constant */
      code span.co { color: #60a0b0; font-style: italic; } /* Comment */
      code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #ba2121; font-style: italic; } /* Documentation */
      code span.dt { color: #902000; } /* DataType */
      code span.dv { color: #40a070; } /* DecVal */
      code span.er { color: #ff0000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #40a070; } /* Float */
      code span.fu { color: #06287e; } /* Function */
      code span.im { color: #008000; font-weight: bold; } /* Import */
      code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #007020; font-weight: bold; } /* Keyword */
      code span.op { color: #666666; } /* Operator */
      code span.ot { color: #007020; } /* Other */
      code span.pp { color: #bc7a00; } /* Preprocessor */
      code span.sc { color: #4070a0; } /* SpecialChar */
      code span.ss { color: #bb6688; } /* SpecialString */
      code span.st { color: #4070a0; } /* String */
      code span.va { color: #19177c; } /* Variable */
      code span.vs { color: #4070a0; } /* VerbatimString */
      code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    </style> 
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "NewsArticle",
      "headline": "Event Driven Style API Design Instead of Old
Procedure Style Ones",
      "image": [
        "https://afoo.me/images/fb_subscribe.jpg"
       ],
      "datePublished": "0000-00-00",
      "author": [{
          "@type": "Person",
          "name": "王福强",
          "url": "https://afoo.me"
        }]
    }
  </script> 
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3687639021943715" crossorigin="anonymous"></script> 
 </head> 
 <body class="antialiased text-gray-900 dark:text-slate-300 tracking-tight bg-white dark:bg-slate-900 vsc-initialized"> 
  <header class="sticky top-0 z-40 flex-none mx-auto w-full bg-white md:bg-white/90 dark:bg-slate-900 dark:md:bg-slate-900/90 md:backdrop-blur-sm border-b dark:border-b-0" id="header"> 
   <div class="py-3 px-3 mx-auto w-full md:flex md:justify-between max-w-6xl md:px-4"> 
    <div class="flex justify-between"> <a class="flex items-center" href="https://afoo.me"> <span class="self-center ml-2 text-2xl font-extrabold text-gray-900 whitespace-nowrap dark:text-white"> <img src="/images/afoo.PNG" alt="logo" style="height:60px;"> </span> </a> 
     <div class="flex items-center md:hidden"> <button type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Toggle between Dark and Light mode" data-toggle-color-scheme=""> 
       <svg viewbox="0 0 24 24" class="w-6 h-6" astro-icon="tabler:sun"> <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"> 
         <circle cx="12" cy="12" r="4"></circle> 
         <path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"> 
         </path> 
        </g> 
       </svg> </button> <button type="button" class="ml-1.5 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center transition" aria-label="Toggle Menu" data-toggle-menu=""> 
       <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveaspectratio="xMidYMid meet" viewbox="0 0 24 24" class="w-6 h-6" astro-icon="tabler:menu"> <g class="icon-tabler" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> 
         <path d="M4 8h16"></path> 
         <path d="M4 16h16"></path> 
        </g> 
       </svg> </button> 
     </div> 
    </div> 
    <nav class="items-center w-full md:w-auto hidden md:flex text-gray-600 dark:text-slate-200 h-screen md:h-auto" aria-label="Main navigation"> 
     <ul class="flex flex-col pt-8 md:pt-0 md:flex-row md:self-center w-full md:w-auto text-xl md:text-base"> 
      <li><a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://kb.afoo.me/">福强私学</a></li> 
      <li> <a id="aiedu" class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="http://ai.afoo.me"> 福强AI学堂</a> </li> 
      <li> <a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="http://jiagoubaike.com">架构百科</a> </li> 
      <li> <a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://afoo.me/posts.html">博客文章 </a> </li> 
      <li> <a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://afoo.me/books.html">创作出版</a> </li> 
      <li> <a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://store.afoo.me">产品与服务</a> </li> 
      <li><a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://auth.afoo.me/user.html">登录信息</a></li> 
      <li> <a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://afoo.me/crosslinks.html">更多链接</a> </li> 
     </ul> 
     <div class="md:self-center flex items-center mb-4 md:mb-0 ml-2"> 
      <div class="hidden items-center md:flex"> <button type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Toggle between Dark and Light mode" data-toggle-color-scheme=""> 
        <svg viewbox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:sun"> <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"> 
          <circle cx="12" cy="12" r="4"></circle> 
          <path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"> 
          </path> 
         </g> 
        </svg> </button> <a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="RSS Feed" href="http://afoo.me/feeds.xml"> 
        <svg viewbox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:rss"> <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"> 
          <circle cx="5" cy="19" r="1"></circle> 
          <path d="M4 4a16 16 0 0 1 16 16M4 11a9 9 0 0 1 9 9"></path> 
         </g> 
        </svg> </a> 
      </div> 
     </div> 
    </nav> 
   </div> 
  </header> 
  <main> 
   <div id="leftSlot" class="visible md:invisible fixed top-0 left-0" style="width: 16rem;height: 80%;margin-top: 4rem;"> <!-- left --> 
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3687639021943715" data-ad-slot="3581141418" data-ad-format="auto" data-full-width-responsive="true"></ins> 
    <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script> 
   </div> 
   <div id="rightSlot" class="visible md:invisible fixed top-0 right-0" style="width: 16rem;height: 80%;margin-top: 4rem;"> <!-- right --> 
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3687639021943715" data-ad-slot="7030836806" data-ad-format="auto" data-full-width-responsive="true"></ins> 
    <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script> 
   </div> 
   <section class="text-gray-600 body-font relative"> 
    <div class="container px-5 py-24 mx-auto mb-12 prose prose-lg dark:prose-invert"> 
     <p class="lead"> </p>
     <h1 class="title">Event Driven Style API Design Instead of Old Procedure Style Ones</h1> 
     <p></p> <!-- random --> 
     <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3687639021943715" data-ad-slot="2722720851" data-ad-format="auto" data-full-width-responsive="true"></ins> 
     <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script> 
     <hr> 
     <p>In fact, I found this is a common problem which often happens on novices, I admit that everyone will take a path to grow up, so I am not blaming someone or something, What I just want to do is to share some experiences or personal opinions on similar scenarios, so that others can benefit and prevent from such problems.</p> 
     <h1 id="background-of-this-topic">Background of this topic</h1> 
     <p>We are working on a project that uses Netty as our network layer framework, so that also means we accept Netty’s API style and design philosophy, that’s event-driven style API design.</p> 
     <p>I setup the whole code framework, then split the LUW to team members so that everyone can start to get down to their work details. But when I started to do some code review on other members’ code, I found some“surprises” .</p> 
     <p>In order to keep the consistency of the whole code framework, I had designed the API in an event-driven style, but I found the interface which works as a contract between different logical layers had been modified into a style of old procedure ones.</p> 
     <p>To find out the story on this, let’s start from the beginning.</p> 
     <h1 id="the-original-event-driven-style-api-design-demonstration">The original event-driven style API design demonstration</h1> 
     <p>We have several layers in our design, a networking layer, a data processing layer and other layers. In the network layer, we receive data packets from event source, and then dispatch the events to the data processing layer which will process the event data as per different situations. With such a prerequisite, we can easily declare an interface as the abstraction to the behavior of processing event data, let’s call it IEventProcessor:</p> 
     <div class="sourceCode" id="cb1">
      <pre class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> IEventProcessor <span class="op">{</span>  </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>       <span class="co">// </span><span class="al">TODO</span><span class="co">  </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre>
     </div> 
     <p>So what u will do with such an interface declaration to abstract proper behaviors as per the above scenario? I don’t know what u will do(although I have known what someone had done), but I do design this interface this way:</p> 
     <div class="sourceCode" id="cb2">
      <pre class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> IEventProcessor<span class="op">&lt;</span>E<span class="op">&gt;</span> <span class="op">{</span>  </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">onBeginEvent</span><span class="op">(</span>E event<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span><span class="op">;</span>  </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">onJoggingEvent</span><span class="op">(</span>E event<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span><span class="op">;</span>  </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">onRunningEvent</span><span class="op">(</span>E event<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span><span class="op">;</span>  </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">onSomeEventWeDontCare</span><span class="op">(</span>E event<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span><span class="op">;</span>  </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">onOtherEventThatPossible</span><span class="op">(</span>E event<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span><span class="op">;</span>  </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre>
     </div> 
     <p>It’s not a big deal u may say, but such design is a proper one as per situation we have above. Why?</p> 
     <ol type="1"> 
      <li><p>The event consumers(I mean different implementations of IEventProcessor) can only care about the events they are interested, and don’t bother with other concerns;</p></li> 
      <li><p>Strong-typed API design setup a strong contract for different layers that stands aside each other. The implementations will know as much as they need to know by only the API that’s exposed to them.</p></li> 
      <li><p>Different concerns are separated to different places. The event dispatching concern, the event-data marshalling concern and the event processing concern, all of them now are taken care of by different parts of the system.</p></li> 
      <li><p>In the period of event processing, if we still have other concerns to deal with, for example, monitoring concern, auditing concern and many more, we can separate them into different AOP aspect and manage them well.</p></li> 
     </ol> 
     <p>Of course, I think we can find more benefits from such a style of API design. And I also think this is a clear and clean API design for our system, but someone does not.</p> 
     <h1 id="current-procedure-style-api-design-demonstration">current procedure style API design demonstration</h1> 
     <p>After code review of some team member’s code, I found he not only break the top implementation class, but also break the original IEventProcessor abstraction. The IEventProcessor interface had been changed to:</p> 
     <div class="sourceCode" id="cb3">
      <pre class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> IEventProcessor<span class="op">{</span>  </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">onEvent</span><span class="op">(</span><span class="dt">byte</span><span class="op">[]</span> eventData<span class="op">,</span> <span class="dt">byte</span> eventType<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span><span class="op">;</span>  </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  </span></code></pre>
     </div> 
     <p>and of course , an implementation is also given:</p> 
     <div class="sourceCode" id="cb4">
      <pre class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> EventProcessor <span class="kw">implements</span> IEventProcessor<span class="op">&lt;</span><span class="dt">byte</span><span class="op">[]&gt;</span> <span class="op">{</span>  </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// fields declarations  </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onEvent</span><span class="op">(</span><span class="dt">byte</span><span class="op">[]</span> eventData<span class="op">,</span> <span class="dt">byte</span> eventType<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span>  </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// preconditions checking  </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">byte</span><span class="op">[]</span> event <span class="op">=</span> ArrayUtils<span class="op">.</span><span class="fu">subarray</span><span class="op">(</span>eventData<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> eventData<span class="op">.</span><span class="fu">length</span><span class="op">);</span>  </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>eventType<span class="op">)</span> <span class="op">{</span>  </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> EventTypes<span class="op">.</span><span class="fu">EVENT_ONE</span><span class="op">:</span>  </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">processEventOne</span><span class="op">(</span>event<span class="op">);</span>  </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                <span class="co">// auditing things  </span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span>  </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> EventTypes<span class="op">.</span><span class="fu">EVENT_TWO</span><span class="op">:</span>  </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">processEventTwo</span><span class="op">(</span>event<span class="op">);</span>  </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                <span class="co">// auditing things  </span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span>  </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> EventTypes<span class="op">.</span><span class="fu">EVENT_THREE</span><span class="op">:</span>  </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">processEventThree</span><span class="op">(</span>event<span class="op">);</span>  </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                <span class="co">// auditing things  </span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span>  </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> EventTypes<span class="op">.</span><span class="fu">EVENT_FOUR</span><span class="op">:</span>  </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                <span class="fu">processEventFour</span><span class="op">(</span>event<span class="op">);</span>  </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                <span class="co">// auditing things  </span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span>  </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> EventTypes<span class="op">.</span><span class="fu">EVENT_FIVE</span><span class="op">:</span>  </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                <span class="fu">processEventFive</span><span class="op">(</span>event<span class="op">);</span>  </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                <span class="co">// auditing things  </span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span>  </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">default</span><span class="op">:</span>  </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span>  </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span>  </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        <span class="co">// other logic  </span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">processEventFive</span><span class="op">(</span><span class="dt">byte</span><span class="op">[]</span> event<span class="op">)</span> <span class="op">{</span>  </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">// </span><span class="al">TODO</span><span class="co"> Auto-generated method stub  </span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">processEventFour</span><span class="op">(</span><span class="dt">byte</span><span class="op">[]</span> event<span class="op">)</span> <span class="op">{</span>  </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">// </span><span class="al">TODO</span><span class="co"> Auto-generated method stub  </span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">processEventThree</span><span class="op">(</span><span class="dt">byte</span><span class="op">[]</span> event<span class="op">)</span> <span class="op">{</span>  </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">// </span><span class="al">TODO</span><span class="co"> Auto-generated method stub  </span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  </span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">processEventTwo</span><span class="op">(</span><span class="dt">byte</span><span class="op">[]</span> event<span class="op">)</span> <span class="op">{</span>  </span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        <span class="co">// </span><span class="al">TODO</span><span class="co"> Auto-generated method stub  </span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">processEventOne</span><span class="op">(</span><span class="dt">byte</span><span class="op">[]</span> event<span class="op">)</span> <span class="op">{</span>  </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>        <span class="co">// </span><span class="al">TODO</span><span class="co"> Auto-generated method stub  </span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> </span></code></pre>
     </div> 
     <p>It may seem OKey to u, but believe me, you still have more to do with.</p> 
     <p>Here are some opinions of mine for this:</p> 
     <ol type="1"> 
      <li><p>First of all, such a API design or directly say implementation breaks the strong-typed contract of original interface design, and turn to a weak typed one which use primitive type int to distinguish different event types. So as a result, every implementations should know which int values are legal and which ones are not. Since every implementations should know same concerns, every implementations may repeat same works too. If strong typed interface design is given, such redundant things or concerns should not appear. This is where strong-typed languages shine.</p></li> 
      <li><p>The implementation involves too much concerns which goes against basic software design principles. It has to take care of dispatching event, auditing event data, and processing event data, etc. A good thing is, the event data marshalling concern is taken care of by different component of the system as I had advised, but we still have too many concerns tangling together here.</p></li> 
      <li><p>Although different event types have been handled to different data processing methods, but a deadly problem is, these methods are declared to be private, which means we can’t even extend the processing logic by inheriting this class. As a contrast, the original IEventProcessor interface design has even better extension ability.</p></li> 
     </ol> 
     <p>I should say, this is the way we do things in old days, It does work, and can be refactored to have a better structure, but we can do it better. As to how, I think you can find it out or already do.</p> 
     <h1 id="what-about-u">What About U?</h1> 
     <p>So What u will do in such scenarios? Which style do you like? Share your opinions and let us all know if you like.</p> 
     <p>I know this topic gets too much into the details of coding level concerns, but I do like such simple topics because you can always extend such topics and gain more if you do think it further from code level to framework level, event to architecture level.</p> <!-- tail --> 
     <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3687639021943715" data-ad-slot="7874087130" data-ad-format="auto" data-full-width-responsive="true"></ins> 
     <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script> 
     <hr> 
     <div> <a href="/posts.html"> <b> &gt;&gt;&gt;&gt;&gt;&gt; 更多阅读 &lt;&lt;&lt;&lt;&lt;&lt; </b></a> 
     </div> 
     <div id="random_posts"> 
      <div class="alert alert-light" role="alert"> <a href="/posts/2010-03-30-isolation-architecture-practice.html">Simple, Yet Powerful系列之“隔离” </a> 
      </div> 
      <div class="alert alert-light" role="alert"> <a href="/posts/2007-03-24-business-is-business.html">就事儿论事儿 </a> 
      </div> 
      <div class="alert alert-light" role="alert"> <a href="/posts/2008-10-12-on-interest-tax-cancel-event.html">由取消利息税想到的 </a> 
      </div> 
     </div> 
     <hr> 
     <div id="comments"></div> 
     <hr> <!-- Section CTA --> 
     <section class="overflow-x-clip bg-zinc-50 py-16 md:py-24"> 
      <div class="relative mx-auto w-full max-w-screen-xl px-4"> 
       <div class="relative z-10 w-full"> <!-- 福强私学推荐 --> 
        <div class="mx-auto max-w-screen-md"> 
         <h2 class="mb-4 text-center text-4xl font-bold md:text-5xl"><a href="https://afoo.me/kb.html" class="border-b">「福强私学」</a>来一个？</h2> 
         <p class="mx-auto mb-8 w-full text-center text-lg leading-8 text-zinc-700 md:w-5/6 md:text-xl">「福强私学」, 一部沉淀了个人成长、技术与架构、组织与管理以及商业上的方法与心法的百科全书。</p> 
        </div> 
        <div class="mx-auto mt-6 w-full md:mt-12 md:w-4/5"> <a href="https://afoo.me/kb.html"> <img alt="footer img for kb.afoo.me" loading="lazy" width="2911" height="1961" decoding="async" data-nimg="1" class="mx-auto rounded-lg object-contain shadow-lg sm:rounded-2xl lg:rounded-3xl" style="color:transparent" src="https://og.afoo.me/?url=footer"> </a> 
        </div> <!-- 小报童推荐 --> 
        <div class="mx-auto max-w-screen-md"> 
         <h2 class="mt-8 mb-4 text-center text-4xl font-bold md:text-5xl"><a href="https://xiaobot.net/p/aifd" class="border-b">福强老师的 AI 通识课</a></h2><a href="https://xiaobot.net/p/aifd" class="border-b"> </a>
        </div><a href="https://xiaobot.net/p/aifd" class="border-b"> </a>
        <div class="mx-auto mt-6 w-full md:mt-12 md:w-4/5">
         <a href="https://xiaobot.net/p/aifd" class="border-b"> </a><a href="https://xiaobot.net/p/aifd"> <img alt="footer img for kb.afoo.me" loading="lazy" width="2911" height="1961" decoding="async" data-nimg="1" class="mx-auto rounded-lg object-contain shadow-lg sm:rounded-2xl lg:rounded-3xl" style="color:transparent" src="/images/xbt-footer.webp"> </a> 
        </div> 
        <div class="mx-auto max-w-screen-md"> 
         <h2 class="mt-8 mb-4 text-center text-4xl font-bold md:text-5xl">更多精彩内容...</h2> 
        </div> 
        <div class="mx-auto mt-6 w-full md:mt-12 md:w-4/5"> 
         <img alt="footer img for kb.afoo.me" loading="lazy" width="2911" height="1961" decoding="async" data-nimg="1" class="mx-auto rounded-lg object-contain shadow-lg sm:rounded-2xl lg:rounded-3xl" style="color:transparent" src="/images/footer-links-2025.webp"> 
        </div> 
       </div> 
      </div> 
     </section> 
     <hr> 
     <p> <span style="font-size: xx-large;"> 开天窗，拉认知，订阅「福报」，即刻拥有自己的全模态人工智能。 </span> </p> <a href="https://wfq.gumroad.com/l/fb"> <img src="/images/fb_subscribe_v2.jpg" alt="订阅「福报」"> </a> 
     <hr> 
     <div hx-get="https://toolfooter.afoo.me/" hx-trigger="revealed" htmx-indicator="#tfloader"> 
      <div id="tfloader" class="x-indicator"> 
       <svg width="57" height="57" viewbox="0 0 57 57" xmlns="http://www.w3.org/2000/svg" stroke="#3F83F8"> <g fill="none" fill-rule="evenodd"> 
         <g transform="translate(1 1)" stroke-width="2"> 
          <circle cx="5" cy="50" r="5"> 
           <animate attributename="cy" begin="0s" dur="2.2s" values="50;5;50;50" calcmode="linear" repeatcount="indefinite" /> 
           <animate attributename="cx" begin="0s" dur="2.2s" values="5;27;49;5" calcmode="linear" repeatcount="indefinite" /> 
          </circle> 
          <circle cx="27" cy="5" r="5"> 
           <animate attributename="cy" begin="0s" dur="2.2s" from="5" to="5" values="5;50;50;5" calcmode="linear" repeatcount="indefinite" /> 
           <animate attributename="cx" begin="0s" dur="2.2s" from="27" to="27" values="27;49;5;27" calcmode="linear" repeatcount="indefinite" /> 
          </circle> 
          <circle cx="49" cy="50" r="5"> 
           <animate attributename="cy" begin="0s" dur="2.2s" values="50;50;5;50" calcmode="linear" repeatcount="indefinite" /> 
           <animate attributename="cx" from="49" to="49" begin="0s" dur="2.2s" values="49;5;27;49" calcmode="linear" repeatcount="indefinite" /> 
          </circle> 
         </g> 
        </g> 
       </svg> 
      </div> 
     </div> 
    </div> 
   </section> 
  </main> 
  <div style="position: fixed; left: 0; bottom: 0; padding: 10px; z-index: 1000;"> 
   <img src="/icons/Written-By-Human-Not-By-AI-Badge-black@2x.png" alt loading="lazy"> 
  </div> 
  <footer class="border-t border-gray-200 dark:border-slate-800"> 
   <div class="max-w-6xl mx-auto px-4 sm:px-6"> 
    <div class="md:flex md:items-center md:justify-between py-6 md:py-8"> 
     <ul class="flex mb-4 md:order-1 -ml-2 md:ml-4 md:mb-0"> 
      <li> <a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Twitter" href="https://twitter.com/afoo_me"> 
        <svg viewbox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-twitter"> <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84 0 0 0 .497-3.753C20.18 7.773 21.692 5.25 22 4.009z"> 
         </path> 
        </svg> </a> </li> 
      <li> <a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Facebook" href="https://www.facebook.com/fujohnwang/"> 
        <svg viewbox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-facebook"> <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 10v4h3v7h4v-7h3l1-4h-4V8a1 1 0 0 1 1-1h3V3h-3a5 5 0 0 0-5 5v2H7"></path> 
        </svg> </a> </li> 
      <li> <a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Github" href="https://github.com/fujohnwang"> 
        <svg viewbox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-github"> <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"> 
         </path> 
        </svg> </a> </li> 
     </ul> 
     <div class="text-sm text-gray-700 mr-4 dark:text-slate-400"> <span class="w-5 h-5 md:w-6 md:h-6 md:-mt-0.5 bg-cover mr-1.5 float-left rounded-sm"> <img src="https://afoo.me/favicon.svg" class="rounded-md" alt> </span> Copyright © 王福强个人版权所有 - Since 2004 (Everything is homebrewed with <a href="https://pandoc.org/">Pandoc</a> and Markdown, little <a href="https://www.scala-lang.org/">Scala</a> also included.) 
     </div> 
    </div> 
   </div> 
  </footer> 
  <script>
        // Set "light" theme as default
        if (!localStorage.theme) {
            localStorage.theme = "light";
        }

        if (
            localStorage.theme === 'dark' ||
            (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
        ) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        function attachEvent(selector, event, fn) {
            const matches = document.querySelectorAll(selector);
            if (matches && matches.length) {
                matches.forEach((elem) => {
                    elem.addEventListener(event, () => fn(elem), false);
                });
            }
        }

        window.onload = function () {
            attachEvent('[data-toggle-menu]', 'click', function (elem) {
                elem.classList.toggle('expanded');
                document.body.classList.toggle('overflow-hidden');
                document.getElementById('header')?.classList.toggle('h-screen');
                document.querySelector('#header nav')?.classList.toggle('hidden');
            });
            attachEvent('[data-toggle-color-scheme]', 'click', function () {
                document.documentElement.classList.toggle('dark');
                localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            });
        };
        window.onpageshow = function () {
            const elem = document.querySelector('[data-toggle-menu]');
            if (elem) {
                elem.classList.remove('expanded');
            }
            document.body.classList.remove('overflow-hidden');
            document.getElementById('header')?.classList.remove('h-screen');
            document.querySelector('#header nav')?.classList.add('hidden');
        };
    </script> 
  <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: '518a605d711883414ac0',
          clientSecret: '69fb8ccc0616c5bcbc64d24ece0d06d279da91ff',
          repo: 'afoo.me.comments',
          owner: 'fujohnwang',
          admin: ['fujohnwang'],
          id: location.pathname.substring(0, 49),      // Ensure uniqueness and length less than 50
          distractionFreeMode: false  // Facebook-like distraction free mode
        })
        gitalk.render('comments')
    </script> 
  <script src="https://formspree.io/js/formbutton-v1.min.js" defer></script> 
  <script>
  /* paste this line in verbatim */
  window.formbutton=window.formbutton||function(){(formbutton.q=formbutton.q||[]).push(arguments)};
  /* customize formbutton below*/     
  formbutton("create", {
    action: "https://formspree.io/f/xknlpkkd",
    title: "有什么可以帮到您？💕💕💕 How can I help you?",
    buttonImg: "<img src='https://afoo.me/hero3/70.webp' alt/>",
    fields: [
      { 
        type: "email", 
        label: "您的电子邮箱（方便与您联系）:", 
        name: "email",
        required: true,
        placeholder: "your@email.com"
      },
      {
        type: "textarea",
        label: "您想提交的反馈和询问信息:",
        name: "message",
        placeholder: "What's on your mind?",
      },
      { type: "submit" }      
    ],
    styles: {
      title: {
        backgroundColor: "blue"
      },
      button: {
        backgroundColor: "blue"
      }
    }
  });
</script> 
  <script>
	// tooltips
	tippy('#aiedu', {
        content: "As to AI nowadays, LLM and Stable Diffusion are hot even hottest among them, If your want to both know-why and know-how with them, instead of only know-how which can't repeat itself, you should get you to https://ai.afoo.me right now ❗"
    });  
</script>  
 </body>
</html>