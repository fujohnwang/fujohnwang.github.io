<!doctype html>
<html lang="zh" class="motion-safe:scroll-smooth 2xl:text-[20px]"> 
 <head> 
  <meta charset="utf-8"> 
  <meta name="keywords" content="Java Daemon Control - 架构师， 架构士，架构教练, 教练, 个人成长, 组织成长, 独立顾问, architecture, book author, thinker, fighter, 架构, 思考, 技术, 武术, 哲学"> 
  <meta name="description" content="Java Daemon Control - 福强说，扶墙老师说，王福强的个人博客， 一个架构士的思考与沉淀"> 
  <meta name="author" content="王福强"> 
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
  <meta name="robots" content="index,follow"> 
  <title>Java Daemon Control -王福强的个人博客：一个架构士的思考与沉淀</title> 
  <link rel="shortcut icon" href="/favicon.ico"> 
  <link rel="canonical" href="https://afoo.me/posts/2010-07-27-java-daemon-control.html"> 
  <link rel="icon" type="image/svg+xml" href="https://afoo.me/favicon.svg"> 
  <link rel="mask-icon" href="https://afoo.me/favicon.svg" color="#3383F8"> 
  <script src="https://unpkg.com/htmx.org@1.9.5"></script> 
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"> 
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script> 
  <script src="https://unpkg.com/@popperjs/core@2"></script> 
  <script src="https://unpkg.com/tippy.js@6"></script> 
  <link rel="stylesheet" href="/css/af.css"> 
  <link rel="stylesheet" href="/css/components.css"> 
  <link ref="stylesheet" href="/css/pygments.css"> 
  <style type="text/css">
        pre > code{
          white-space: pre-wrap;
          font-family: monospace;
          font-size: 14px;
          /* border-left: blueviolet;
          border-left-width: thick;
          border-left-style: double;
          padding-left: 1rem !important; */
        }
        
        .x-indicator{
            display:none;
        }
        .htmx-request .x-indicator{
            display:inline;
        }
        .htmx-request.x-indicator{
            display:inline;
        }
    </style> 
  <style type="text/css">
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ff0000; font-weight: bold; } /* Alert */
      code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #7d9029; } /* Attribute */
      code span.bn { color: #40a070; } /* BaseN */
      code span.bu { } /* BuiltIn */
      code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4070a0; } /* Char */
      code span.cn { color: #880000; } /* Constant */
      code span.co { color: #60a0b0; font-style: italic; } /* Comment */
      code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #ba2121; font-style: italic; } /* Documentation */
      code span.dt { color: #902000; } /* DataType */
      code span.dv { color: #40a070; } /* DecVal */
      code span.er { color: #ff0000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #40a070; } /* Float */
      code span.fu { color: #06287e; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #007020; font-weight: bold; } /* Keyword */
      code span.op { color: #666666; } /* Operator */
      code span.ot { color: #007020; } /* Other */
      code span.pp { color: #bc7a00; } /* Preprocessor */
      code span.sc { color: #4070a0; } /* SpecialChar */
      code span.ss { color: #bb6688; } /* SpecialString */
      code span.st { color: #4070a0; } /* String */
      code span.va { color: #19177c; } /* Variable */
      code span.vs { color: #4070a0; } /* VerbatimString */
      code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    </style> 
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "NewsArticle",
      "headline": "Java Daemon Control",
      "image": [
        "https://afoo.me/images/fb_subscribe.jpg"
       ],
      "datePublished": "0000-00-00",
      "author": [{
          "@type": "Person",
          "name": "王福强",
          "url": "https://afoo.me"
        }]
    }
  </script> 
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3687639021943715" crossorigin="anonymous"></script> 
 </head> 
 <body class="antialiased text-gray-900 dark:text-slate-300 tracking-tight bg-white dark:bg-slate-900 vsc-initialized"> 
  <header class="sticky top-0 z-40 flex-none mx-auto w-full bg-white md:bg-white/90 dark:bg-slate-900 dark:md:bg-slate-900/90 md:backdrop-blur-sm border-b dark:border-b-0" id="header"> 
   <div class="py-3 px-3 mx-auto w-full md:flex md:justify-between max-w-6xl md:px-4"> 
    <div class="flex justify-between"> <a class="flex items-center" href="https://afoo.me"> <span class="self-center ml-2 text-2xl font-extrabold text-gray-900 whitespace-nowrap dark:text-white"> <h1>王福强的博客</h1> </span> </a> 
     <div class="flex items-center md:hidden"> <button type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Toggle between Dark and Light mode" data-toggle-color-scheme=""> 
       <svg viewbox="0 0 24 24" class="w-6 h-6" astro-icon="tabler:sun"> <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"> 
         <circle cx="12" cy="12" r="4"></circle> 
         <path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"> 
         </path> 
        </g> 
       </svg> </button> <button type="button" class="ml-1.5 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center transition" aria-label="Toggle Menu" data-toggle-menu=""> 
       <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveaspectratio="xMidYMid meet" viewbox="0 0 24 24" class="w-6 h-6" astro-icon="tabler:menu"> <g class="icon-tabler" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> 
         <path d="M4 8h16"></path> 
         <path d="M4 16h16"></path> 
        </g> 
       </svg> </button> 
     </div> 
    </div> 
    <nav class="items-center w-full md:w-auto hidden md:flex text-gray-600 dark:text-slate-200 h-screen md:h-auto" aria-label="Main navigation"> 
     <ul class="flex flex-col pt-8 md:pt-0 md:flex-row md:self-center w-full md:w-auto text-xl md:text-base"> 
      <li><a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://kb.afoo.me/">福强私学</a></li> 
      <li> <a id="aiedu" class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="http://ai.afoo.me"> 福强AI学堂</a> </li> 
      <li> <a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="http://jiagoubaike.com">架构百科</a> </li> 
      <li> <a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://afoo.me/posts.html">博客文章 </a> </li> 
      <li> <a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://afoo.me/books.html">创作出版</a> </li> 
      <li> <a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://store.afoo.me">产品与服务</a> </li> 
      <li><a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://auth.afoo.me/user.html">登录信息</a></li> 
      <li> <a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://afoo.me/crosslinks.html">更多链接</a> </li> 
     </ul> 
     <div class="md:self-center flex items-center mb-4 md:mb-0 ml-2"> 
      <div class="hidden items-center md:flex"> <button type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Toggle between Dark and Light mode" data-toggle-color-scheme=""> 
        <svg viewbox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:sun"> <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"> 
          <circle cx="12" cy="12" r="4"></circle> 
          <path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"> 
          </path> 
         </g> 
        </svg> </button> <a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="RSS Feed" href="http://afoo.me/feeds.xml"> 
        <svg viewbox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:rss"> <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"> 
          <circle cx="5" cy="19" r="1"></circle> 
          <path d="M4 4a16 16 0 0 1 16 16M4 11a9 9 0 0 1 9 9"></path> 
         </g> 
        </svg> </a> 
      </div> 
     </div> 
    </nav> 
   </div> 
  </header> 
  <main> 
   <div id="leftSlot" class="visible md:invisible fixed top-0 left-0" style="width: 16rem;height: 80%;margin-top: 4rem;"> <!-- left --> 
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3687639021943715" data-ad-slot="3581141418" data-ad-format="auto" data-full-width-responsive="true"></ins> 
    <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script> 
   </div> 
   <div id="rightSlot" class="visible md:invisible fixed top-0 right-0" style="width: 16rem;height: 80%;margin-top: 4rem;"> <!-- right --> 
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3687639021943715" data-ad-slot="7030836806" data-ad-format="auto" data-full-width-responsive="true"></ins> 
    <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script> 
   </div> 
   <section class="text-gray-600 body-font relative"> 
    <div class="container px-5 py-24 mx-auto mb-12 prose prose-lg dark:prose-invert"> 
     <p class="lead"> </p>
     <h1 class="title">Java Daemon Control</h1> 
     <p></p> <!-- random --> 
     <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3687639021943715" data-ad-slot="2722720851" data-ad-format="auto" data-full-width-responsive="true"></ins> 
     <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script> 
     <hr> 
     <p>As to desktop or normal Java applications, we can easily know when we should shutdown the application or not, because users have explicit ways to do this, for example, for a Swing Application, usually a “CLOSE” menu or tool-bar item will be available, or directly click the “X” icon on the left/right top of the window. But for a Java application that will be run as a server process(which don’t need interactive behavior), what we do?</p> 
     <h1 id="old-days-solutions">Old Days Solutions</h1> 
     <p>Directly “kill -9” ? Of course, that’s a way, but that’s too brutal.</p> 
     <p>A Java process that will be run as a server process usually will be sent to OS’s background to run, that’s called “daemon” on Unix and “service” on Windows. A Simple way to control the life-cycle of a Java daemon is to start a loop and wait for user input, like this:</p> 
     <div class="sourceCode" id="cb1">
      <pre class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="bu">BufferedReader</span> reader <span class="op">=</span> <span class="kw">new</span> <span class="bu">BufferedReader</span><span class="op">(</span><span class="kw">new</span> <span class="bu">InputStreamReader</span><span class="op">(</span><span class="bu">System</span><span class="op">.</span><span class="fu">in</span><span class="op">));</span>  </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> line <span class="op">=</span> <span class="kw">null</span><span class="op">;</span>  </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span> <span class="op">{</span>  </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> reader<span class="op">.</span><span class="fu">readLine</span><span class="op">();</span>  </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>line <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> line<span class="op">.</span><span class="fu">equals</span><span class="op">(</span><span class="st">"quit"</span><span class="op">))</span> <span class="op">{</span>  </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span> <span class="co">// and exit gracefully  </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span><span class="kw">true</span><span class="op">);</span>  </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">// clean up and exit  </span></span></code></pre>
     </div> 
     <p>This solution is better than just start an infinite loop and do nothing, because the latter solution will occupy all of your CPU’s power(I have seen such a stupid solution and it does exist). But this is still not a best one, although users can interactive with it, the process itself have no way to notify the process to exit. That’s, you can control it from outside, but can’t do it from inside.</p> 
     <p>Another mostly used solution is, start a TCP server socket and listen control requests, when termination control request is received, a loop based on control flag will break and exit. This is similar to above solution, just with another communication channel. <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p> 
     <p>A common pattern for both solution can be found,that’s, set up a control flag to start a loop with, and then wait for other channels to change the control flag. This can be formulated as:</p> 
     <div class="sourceCode" id="cb2">
      <pre class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">boolean</span> running <span class="op">=</span> <span class="kw">true</span><span class="op">;</span>  </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span><span class="op">(</span>running<span class="op">)</span>  </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span>  </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// do Sth.  </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">// exit</span></span></code></pre>
     </div> 
     <p>As to how to change the control flag, there are two solutions presented, can you find more?</p> 
     <h1 id="alternatives-available-today">Alternatives Available Today</h1> 
     <p>Old Days Solutions have their pros and cons, today more solutions are available for us.</p> 
     <p>The first one is Jakarta Commons Daemon . It provides a Java daemon solution with native Jsvc and Procrun support.</p> 
     <p>The second and third are Java Service Wrapper and yajsw , The former is a commerce solution now, and the latter is an open source one which has some works based on the former(there is a possibility that I misunderstand its introduction).</p> 
     <p>Other Solutions are Akuma , Start-Stop-Daemon, or Classword , but I don’t get patience to read their document. If you are interested in them,follow the links I provide or google them.</p> 
     <h1 id="my-choice">My Choice</h1> 
     <p>I choose to combine shell and “sun.misc.Signal” and “sun.misc.SignalHandler” to achieve Java daemon, because they are much simpler to me to understand them and use them. The Shell will take care of running-in-background stuff:</p> 
     <div class="sourceCode" id="cb3">
      <pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/sh  </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-cp</span> your_class_path com.domain.main_class <span class="op">&lt;&amp;</span>- <span class="kw">&amp;</span>  </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="va">pid</span><span class="op">=</span><span class="va">$!</span>  </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">${pid}</span> <span class="op">&gt;</span> mydaemon.pid  </span></code></pre>
     </div> 
     <p>And “sun.misc.Signal” and “sun.misc.SignalHandler” will take care of controlling the life-cycle of the program. About “sun.misc.Signal” and “sun.misc.SignalHandler” , you can find more information at 参考文档 , here I just simply introduce how to use them together to achieve asynchronous communication between processes or just internally in a same process.</p> 
     <p>The concept of “sun.misc.Signal” and “sun.misc.SignalHandler” is simple</p> 
     <h2 id="signal">Signal</h2> 
     <p>Signal is the signal that u will send to SignalHandler to process, so you can create a Signal just like instantiate a simple value object:</p> 
     <div class="sourceCode" id="cb4">
      <pre class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Signal sig <span class="op">=</span> <span class="kw">new</span> <span class="fu">Signal</span><span class="op">(</span><span class="st">"USR1"</span><span class="op">);</span>  </span></code></pre>
     </div> 
     <p>The signal names you pass to “Signal” conform a pattern, that’s, remove the prefix “SIG” from the name of the standard signals that’s used by JVM. For example, if you want to send “SIGINT” , then you create “Signal” instance with name of “INT” ; If you want to send “SIGTERM” , you create “Signal” instance with name of “TERM” :</p> 
     <div class="sourceCode" id="cb5">
      <pre class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Signal interactiveSignal <span class="op">=</span> <span class="kw">new</span> <span class="fu">Signal</span><span class="op">(</span><span class="st">"INT"</span><span class="op">);</span>  </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Signal terminationSignal <span class="op">=</span> <span class="kw">new</span> <span class="fu">Signal</span><span class="op">(</span><span class="st">"TERM"</span><span class="op">);</span></span></code></pre>
     </div> 
     <p>Fucking Simple, right?</p> 
     <p>After you have a Signal, you can send it out by using “Signal” class’s “raise” method:</p> 
     <div class="sourceCode" id="cb6">
      <pre class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Signal<span class="op">.</span><span class="fu">raise</span><span class="op">(</span>sig<span class="op">);</span>   </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>Signal<span class="op">.</span><span class="fu">raise</span><span class="op">(</span>interactiveSignal<span class="op">);</span>   </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>Signal<span class="op">.</span><span class="fu">raise</span><span class="op">(</span>terminationSignal<span class="op">);</span>   </span></code></pre>
     </div> 
     <h2 id="signalhandler">SignalHandler</h2> 
     <p>As the name indicates, “SignalHandler” will take the responsibility of handling the “Signal” s. You implements your own signal handlers by implementing the “SignalHandler” interface. It has only one method:</p> 
     <div class="sourceCode" id="cb7">
      <pre class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MySigHandler <span class="kw">implements</span> SignalHandler <span class="op">{</span>  </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handle</span><span class="op">(</span>Signal sig<span class="op">)</span> <span class="op">{</span>  </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ...  </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  </span></code></pre>
     </div> 
     <p>It’s fucking simple too.</p> 
     <h2 id="glue-them-together">Glue them together</h2> 
     <p>After you get both “Signal” and “SignalHandler” of your own, you should link them together to make it work. This is by “Signal” class’s static method “handle” :</p> 
     <div class="sourceCode" id="cb8">
      <pre class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>MySigHandler sigHandler <span class="op">=</span> <span class="kw">new</span> <span class="fu">MySigHandler</span><span class="op">();</span>  </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Signal<span class="op">.</span><span class="fu">handle</span><span class="op">(</span>sig<span class="op">,</span> sigHandler<span class="op">);</span>  </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>Signal<span class="op">.</span><span class="fu">handle</span><span class="op">(</span>interactiveSignal<span class="op">,</span> sigHandler<span class="op">);</span>  </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>Signal<span class="op">.</span><span class="fu">handle</span><span class="op">(</span>terminationSignal<span class="op">,</span> sigHandler<span class="op">);</span>  </span></code></pre>
     </div> 
     <p>Now as long as you add them to your java programs and send proper signals to it, the pairs of “Signal” and “SignalHandler” will work for you.</p> 
     <p>You have 2 ways to send signals to your program’s process:</p> 
     <ol type="1"> 
      <li>Use Signal.raise() internally. 
       <ul> 
        <li>This can help to coordinate application’s internal state and help to control the life-cycle internally. For example, as long as internal worker thread dies, it can send out a signal, when signal hander finds that all other the worker threads die, it can change the control flag of the whole process and terminate it gracefully.</li> 
       </ul></li> 
      <li>Send Signal from other processes. 
       <ul> 
        <li>directly send out supported OS signal via shell scripts: <code>kill -s SIGUSR1 &lt;pid of the process&gt;</code>, combining the pid you get in before shell, this works perfectly.</li> 
       </ul></li> 
     </ol> 
     <p>The only cons to use “Signal” and “SignalHandler” is, they are both restricted API which are not guaranteed.</p> 
     <h1 id="参考文档">参考文档</h1> 
     <ol type="1"> 
      <li>Revelations on Java signal handling and termination . http://www.ibm.com/developerworks/java/library/i-signalhandling/ .</li> 
      <li>基于OS信号实现Java异步通知 . http://kenwublog.com/java-asynchronous-notify-based-on-signal .</li> 
      <li>Java Daemon . http://barelyenough.org/blog/2005/03/java-daemon/ .</li> 
     </ol> 
     <section class="footnotes" role="doc-endnotes"> 
      <hr> 
      <ol> 
       <li id="fn1" role="doc-endnote"><p>To use this solution, you’d better add authentication to your control service so that others with malicious purpose will not hurt you.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li> 
      </ol> 
     </section> <!-- tail --> 
     <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3687639021943715" data-ad-slot="7874087130" data-ad-format="auto" data-full-width-responsive="true"></ins> 
     <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script> 
     <hr> 
     <div> <a href="/posts.html"> <b> &gt;&gt;&gt;&gt;&gt;&gt; 更多阅读 &lt;&lt;&lt;&lt;&lt;&lt; </b></a> 
     </div> 
     <div id="random_posts"> 
      <div class="alert alert-light" role="alert"> <a href="/posts/2017-04-26-ending-is-the-new-beginning.html">好聚好散是最好的结局和起点 </a> 
      </div> 
      <div class="alert alert-light" role="alert"> <a href="/posts/2021-04-01-deprecated-software-methodology.html">那些曾经风靡一时的研发方法论 </a> 
      </div> 
      <div class="alert alert-light" role="alert"> <a href="/posts/2020-02-19-combine-east-and-west.html">谈古今论中西，问题是你谈论对了吗？ </a> 
      </div> 
     </div> 
     <hr> 
     <div id="comments"></div> 
     <hr> <!-- Section CTA --> 
     <section> <!-- Container --> 
      <div class="mx-auto w-full max-w-7xl px-5 py-16 md:px-10"> <!-- Component--> 
       <div class="grid items-center gap-8 sm:gap-20 lg:grid-cols-2"> 
        <div> 
         <h2 class="mb-4 max-w-2xl text-3xl font-bold md:text-5xl"><a href="https://afoo.me/kb.html">欢迎加入「福强私学」</a></h2> 
         <p class="mb-3 max-w-lg text-sm text-[#636262] sm:text-base">跨越2190个日夜，始终坚持“实践 + 原创”打造的715125字专属知识库，囊括了（但不限于）从职场、技术、管理与商业等多个板块的内容。</p> 
         <ul class="mb-3 max-w-lg text-sm text-[#636262] sm:text-base"> 
          <li>一个ChatGPT触达不到的地方</li> 
          <li>一个带你超越AI/人工智能的地方</li> 
          <li>一个与你一起成长的地方</li> 
         </ul> 
         <p class="mb-4 max-w-lg text-sm text-[#636262] sm:text-base"> <a href="https://afoo.me/kb.html" class="border-b">https://afoo.me/kb.html</a> </p> 
        </div> 
        <div> <a href="https://afoo.me/kb.html"> <img src="https://afoo.me/qrcodes/kb.afoo.me.png" alt="" class="mx-auto inline-block h-full w-full max-w-2xl"> </a> 
        </div> 
       </div> 
      </div> 
     </section> 
     <hr> 
     <p> <span style="font-size: xx-large;"> 开天窗，拉认知，订阅「福报」，即刻拥有自己的全模态人工智能。 </span> </p> <a href="https://wfq.gumroad.com/l/fb"> <img src="/images/fb_subscribe_v2.jpg" alt="订阅「福报」"> </a> 
     <hr> 
     <div hx-get="https://toolfooter.afoo.me/" hx-trigger="revealed" htmx-indicator="#tfloader"> 
      <div id="tfloader" class="x-indicator"> 
       <svg width="57" height="57" viewbox="0 0 57 57" xmlns="http://www.w3.org/2000/svg" stroke="#3F83F8"> <g fill="none" fill-rule="evenodd"> 
         <g transform="translate(1 1)" stroke-width="2"> 
          <circle cx="5" cy="50" r="5"> 
           <animate attributename="cy" begin="0s" dur="2.2s" values="50;5;50;50" calcmode="linear" repeatcount="indefinite" /> 
           <animate attributename="cx" begin="0s" dur="2.2s" values="5;27;49;5" calcmode="linear" repeatcount="indefinite" /> 
          </circle> 
          <circle cx="27" cy="5" r="5"> 
           <animate attributename="cy" begin="0s" dur="2.2s" from="5" to="5" values="5;50;50;5" calcmode="linear" repeatcount="indefinite" /> 
           <animate attributename="cx" begin="0s" dur="2.2s" from="27" to="27" values="27;49;5;27" calcmode="linear" repeatcount="indefinite" /> 
          </circle> 
          <circle cx="49" cy="50" r="5"> 
           <animate attributename="cy" begin="0s" dur="2.2s" values="50;50;5;50" calcmode="linear" repeatcount="indefinite" /> 
           <animate attributename="cx" from="49" to="49" begin="0s" dur="2.2s" values="49;5;27;49" calcmode="linear" repeatcount="indefinite" /> 
          </circle> 
         </g> 
        </g> 
       </svg> 
      </div> 
     </div> 
    </div> 
   </section> 
  </main> 
  <footer class="border-t border-gray-200 dark:border-slate-800"> 
   <div class="max-w-6xl mx-auto px-4 sm:px-6"> 
    <div class="md:flex md:items-center md:justify-between py-6 md:py-8"> 
     <ul class="flex mb-4 md:order-1 -ml-2 md:ml-4 md:mb-0"> 
      <li> <a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Twitter" href="https://twitter.com/afoo_me"> 
        <svg viewbox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-twitter"> <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84 0 0 0 .497-3.753C20.18 7.773 21.692 5.25 22 4.009z"> 
         </path> 
        </svg> </a> </li> 
      <li> <a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Facebook" href="https://www.facebook.com/fujohnwang/"> 
        <svg viewbox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-facebook"> <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 10v4h3v7h4v-7h3l1-4h-4V8a1 1 0 0 1 1-1h3V3h-3a5 5 0 0 0-5 5v2H7"></path> 
        </svg> </a> </li> 
      <li> <a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Github" href="https://github.com/fujohnwang"> 
        <svg viewbox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-github"> <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"> 
         </path> 
        </svg> </a> </li> 
     </ul> 
     <div class="text-sm text-gray-700 mr-4 dark:text-slate-400"> <span class="w-5 h-5 md:w-6 md:h-6 md:-mt-0.5 bg-cover mr-1.5 float-left rounded-sm"> <img src="https://afoo.me/favicon.svg" class="rounded-md" alt> </span> Copyright © 王福强个人版权所有 - Since 2004 (Everything is homebrewed with <a href="https://pandoc.org/">Pandoc</a> and Markdown, little <a href="https://www.scala-lang.org/">Scala</a> also included.) 
     </div> 
    </div> 
   </div> 
  </footer> 
  <script>
        // Set "light" theme as default
        if (!localStorage.theme) {
            localStorage.theme = "light";
        }

        if (
            localStorage.theme === 'dark' ||
            (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
        ) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        function attachEvent(selector, event, fn) {
            const matches = document.querySelectorAll(selector);
            if (matches && matches.length) {
                matches.forEach((elem) => {
                    elem.addEventListener(event, () => fn(elem), false);
                });
            }
        }

        window.onload = function () {
            attachEvent('[data-toggle-menu]', 'click', function (elem) {
                elem.classList.toggle('expanded');
                document.body.classList.toggle('overflow-hidden');
                document.getElementById('header')?.classList.toggle('h-screen');
                document.querySelector('#header nav')?.classList.toggle('hidden');
            });
            attachEvent('[data-toggle-color-scheme]', 'click', function () {
                document.documentElement.classList.toggle('dark');
                localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            });
        };
        window.onpageshow = function () {
            const elem = document.querySelector('[data-toggle-menu]');
            if (elem) {
                elem.classList.remove('expanded');
            }
            document.body.classList.remove('overflow-hidden');
            document.getElementById('header')?.classList.remove('h-screen');
            document.querySelector('#header nav')?.classList.add('hidden');
        };
    </script> 
  <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: '518a605d711883414ac0',
          clientSecret: '69fb8ccc0616c5bcbc64d24ece0d06d279da91ff',
          repo: 'afoo.me.comments',
          owner: 'fujohnwang',
          admin: ['fujohnwang'],
          id: location.pathname.substring(0, 49),      // Ensure uniqueness and length less than 50
          distractionFreeMode: false  // Facebook-like distraction free mode
        })
        gitalk.render('comments')
    </script> 
  <script src="https://formspree.io/js/formbutton-v1.min.js" defer></script> 
  <script>
  /* paste this line in verbatim */
  window.formbutton=window.formbutton||function(){(formbutton.q=formbutton.q||[]).push(arguments)};
  /* customize formbutton below*/     
  formbutton("create", {
    action: "https://formspree.io/f/xknlpkkd",
    title: "有什么可以帮到您？💕💕💕 How can I help you?",
    buttonImg: "<img src='https://afoo.me/hero3/70.webp' alt/>",
    fields: [
      { 
        type: "email", 
        label: "您的电子邮箱（方便与您联系）:", 
        name: "email",
        required: true,
        placeholder: "your@email.com"
      },
      {
        type: "textarea",
        label: "您想提交的反馈和询问信息:",
        name: "message",
        placeholder: "What's on your mind?",
      },
      { type: "submit" }      
    ],
    styles: {
      title: {
        backgroundColor: "blue"
      },
      button: {
        backgroundColor: "blue"
      }
    }
  });
</script> 
  <script>
	// tooltips
	tippy('#aiedu', {
        content: "As to AI nowadays, LLM and Stable Diffusion are hot even hottest among them, If your want to both know-why and know-how with them, instead of only know-how which can't repeat itself, you should get you to https://ai.afoo.me right now ❗"
    });  
</script>  
 </body>
</html>