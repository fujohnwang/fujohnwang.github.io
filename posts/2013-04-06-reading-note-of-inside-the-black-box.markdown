% 《打开量化投资的黑箱》读书笔记
% 王福强

英文名: inside the black box - the simple truth about quantitative trading


# 个人感受
1. 对alpha模型，风控模型和成本模型三者的关系，采用乐观主义者，悲观主义者和精打细算的会计来类比，很不错；
2. 整书的提纲挈领做的很好， Have a nice big picture；
3. 内容深浅适度，挺适合我这种人读 ：）
4. 仅仅可用来作为入门和了解的书籍，要真正落实，则还有很长的一段路要走!
5. 量化建模也尤其有限的特别适合的场景，超出这些场景或者用错场景，极有可能招致灾难；


# 量化交易模型Big Picture

```scala
((alpha model, risk model, transaction cost model) => portfolio construction model) <=> execution model
```

# alpha模型类别

1. 理论驱动型
	- 基于价格相关数据的策略
		- 趋势(跟随)策略
		- 均值回复策略(即趋势反转型)
	- 基于基本面数据的策略
		- 价值型/收益型策略
		- 成长型策略
		- 品质型策略
2. 数据驱动型
3. 混合型
	- 线性模型
		- 等权重模型("既然无法预测和分派确切的权重，那就全都一样就好了")
	- 非线性模型
		- 条件模型(conditional model)
			- 根据决策条件来触发交易行为
		- 旋转模型(rotation model)
			- 根据模型收益等因素实时迭代计算并重新调整各权重指标
	- 机器学习模型

# 策略的实施

1. 预测目标
	- 方向
	- 幅度
	- 运动的持续时间
	- 预测的置信度
	- 概率
2. 投资期限
	- high frequency (< day)
	- short term (day - weeks)
	- medium term (weeks - months)
	- long term (> months)
3. 投注结构
	- 单一
	- 多元
4. 投资范围
	- 地域(geography)
	- 资产类别(asset class)
	- 金融产品类别(instrument class)
		- 流动性特征
		- 市场参与者特征
5. 模型设置
6. 运行频率


# 风险控制模型

<blockquote>
风险管理并不只是规避风险或者减少损失，它是为了提高回报的质量和持续性， 而面对敞口(exposure)实施有目的的选择和规模控制。
</blockquote>

## 限制风险的大小

1. 通过严格的约束条件和惩罚机制来限制头寸的大小
	- 投资标准基线， 超出部分激活惩罚机制， 离基线越远， 增加额外规模则越困难
2. 如何度量风险的大小
	- 通过投资组合回报的标准差体现的“波动率”指标度量来衡量
	- 离散/相似性
		- 相似性越高， 风险越大
3. 限制措施应用的场景和范围
	- 单一或者组合头寸
	- 不同类型风险敞口规模
		- 市场因素
		- 市值因素
4. 调整杠杆
	- VaR模型(Value at Risk) - 根据波动率来调整杠杆比率

## 限制风险的类型

1. 理论驱动型风控模型
	- “通常关注__已知__名称的或者系统性的风险因素”
2. 经验性风控模型
	- 历史数据=> 统计技术 => 主成份分析法(PCA) => 不知名的但与现实相对应的系统性风险
	- Cons
		- 对结构变化的时机捕捉不及时
		- 需要大量历史样本数据来强化统计的解释力
3. 结合两种模型


# 交易成本模型

<blockquote>
奢难达富， 俭不致贫 - 萨缪尔.约翰逊
</blockquote>

交易成本模型背后的思想是， 任何交易都要花费成本。

## 交易成本定义
1. 佣金和费用
	- 清算和结算费用，有时候可能包含到佣金中
2. 滑点(slippage)
	- 指提交订单到订单被执行这段时间内价格的变化
3. 市场冲击
	- 自身订单进入交易池后对市场的影响，一般用市场订单进入交易所和交易被实际执行两个时间之间的价格差来定义

## 交易成本模型的类型

y = f(x), y为交易成本， x为交易规模

1. 常数交易成本模型
	- 基本不现实，只有一点与实际成本曲线相交/拟合
2. 线性交易成本模型
	- 建模简单，拟合性不好（2个点相交/拟合）
3. 分段线性交易成本模型
	- 与实际交易成本曲线拟合性很好，计算量适中
4. 二次型交易成本模型
	- 拟合性更好，但计算量大


# 投资组合构建模型(portfolio construction model)


```scala
投资组合构建模型 => 投资组合
```

## 基于规则的投资组合构建模型

基于直觉

1. 相等头寸权重
2. 相等风险权重
	- 根据头寸波动率反向调整头寸规模， 或者使用其他风险度量，比如下跌幅度
3. 阿尔法驱动的权重
	- 根据阿尔法模型的输入来决定头寸规模
	- 这种模型下，预警很重要（因为历史数据带来的延迟效果反馈可能导致问题）
4. 决策树权重
	- 组合多种模型输入并采用决策树来构建投资组合

## 基于最优化工具的投资组合构建模型

基于现代投资组合理论的逻辑思路

### 最优化工具的输入
1. 期望回报
2. 期望波动率
3. 期望相关性

### 最优化技术
1. 无约束条件的最优化
2. 有约束条件的最优化
3. 布莱克-莱特曼最优化方法
	- 引入投资者对涉及的不同金融产品的回报预测因素
4. 格里诺德-卡恩方法
	- 因素投资组合最优化
5. 基于数据挖掘的最优化方法


# 执行模型

简单来讲，就是将订单通过相应的交易通道，投递到相应的流动性订单池

## 交易方式
1. 电子化交易
2. 通过人工中介交易（比如经纪商）
	- 实际上是人工输入电子化交易系统，最终都是电子化交易

## 订单执行算法
根据订单类型， 订单执行策略（主动还是被动），订单大小，订单的明暗以及下订单的流动性池子， 订单的撤销与重置等因素来自己开发算法或者购买和使用经纪商或者第三方算法和软件

<blockquote>
通过订单的撤销等手段来探测市场对流动性深度的反应，从而为依赖反应模式而获利提供有效信息
</blockquote>

## 高频交易
适合小规模资产，大规模的高频交易会大幅度的改变市场，以至于预测价格与最终执行价格非常接近，无多少利润空间。

“鲨鱼”算法， 跟踪和依附“冰山”暗订单之上/前， 借助于“冰山”推高价格的同时盈利。

## 交易基础设施
1. 硬件
	- 定制芯片
2. 软件
	- 操作系统
	- 交易软件
3. 协议
	- FIX
	- 自定义FIX Engine(尤其对于对性能追求卓越，且资金规模雄厚的宽客)
	- socket
	- direct database access
4. 交易通道
	- DMA(direct market access)- 毫秒级别
	- colocation(同地机房) - 微妙级别(1/4毫秒)
	- sponsored access

# 数据
1. 数据的重要性
	- 输入 => 输出
	- 搞错输入，即使函数模型等再正确也是枉然， 所谓的garbage in, garbage out效应
2. 数据的类型
	- 价格相关的数据
	- 基本面数据
3. 数据来源
	- 交易商
	- 监管者
	- 政府
	- 公司
	- 新闻机构
	- 专门的数据提供商
4. 数据的整理
	- 处理缺失的数据
		- 识别
		- 填补缺省默认值
	- 处理可能的错误数据
		- spike filter
		- bad print - 坏点
5. 数据存储
	- flat file
	- indexed flat file
	- RDBMS
		- data cube

# 研究

主要讨论了方法， 思想来源， 检验和假设相关内容

思想来源可以归纳为如下四种：

1. 市场观察
2. 学术文献
3. 挖掘其他量化交易机构的交易者并向其学习
4. 主观判断型交易者的教训

检验的话则通过样本内数据和样本外数据以及各种指标进行， 指标详情就不列了。

整个过程倾向于遵循爱因斯坦的这句：
<blockquote>
每件事都应力求简单，而又不能过于简单。
</blockquote>

# 量化交易策略的固有风险
	
1. 模型风险(model risk)
	- 建模的不适宜性(the inapplicability of modeling)
	- 模型的错误设置(misspecification)
		- 马鞍套在牛身上 ：）
	- 执行错误(implementation errors)
		- 比如手贱输错交易指令，系统重启而忽略了依赖关系的先后顺序，等等
2. 市场逻辑变更风险
	- 市场风向突变等小概率事件
3. 外部冲击风险(exogenous shock)
	- 战争， 恐怖袭击，etc.
4. 扩散风险或者说同质投资者风险
	- 一窝蜂的往一处钻，结果[出了事儿]，谁也跑不掉 ：）
	- crowded trade

## 风险检测工具
1. 敞口检测工具
2. 盈利和亏损检测工具
3. 执行检测工具
	- auditing
4. 系统性能检测工具

# 有关宽客的批评，评价，展望
后面几章大体上没有啥要有条理的记录的，唯一印象深刻的是拷问诚信的内容，作者引用了《审问者》这本书里提到的一些技巧和准则以及在具体场景下的案例，感觉很有意思，或许可以进一步挖掘。 不过，对于那种信口雌黄的主儿，这些技巧和准则可能就没有什么作用了。 比如“好的问题和好的回答比业务记录重要的多”，以及“（在发生了如此多的丑闻之后），名声和业务记录对于判断基金经理是否诚信往往都是不够的”。

另外， 作者提到“一些小的公司长期疲于奔命， 很少与其他人有任何接触”， 这一点其实落到人和某些群体上，所见，所闻，所感同身受，窃以为如此。




# 术语

1. quantative trading strategies - 量化交易策略
2. quants - 量化交易者， 俗称宽客
3. high frequency trading - 高频交易
4. algorithmic trading engines
5. 携带交易(carry trade)
	- 携带所得(carry)
6. 量化多空策略(quant long/short, QLS)
7. 移动平均线(moving average)
8. 市盈率(price to earnings) - P/E
	- 指某一上市公司的股票市价(price)与过去一年中每股盈利(earning)的比率
9. 市净率
	- 市净率指的是市价(price)与每股净资产(book value)之间的比值，市净率=股票市价/每股净资产,比值越低意味着风险越低
10. 帐面价值(Book Value) 
	- 帐面价值指的是股票实际的资产价值，也就是公司的总资产净值除以发行股数的後所得出的值
11. flight-to-quality策略
	- 寻求本金安全的一种策略
12. 敞口(exposure)
13. 系统性风险
	- 即无法被分散的风险，如汇率风险，部门风险因素和市值风险因素（大市值or小市值）
13. 订单簿深度(Depth of Book)
	- or 价格深度
14. 做市商(Market Maker)
15. 电子通信网络(Electronic Communication Networks, ECN)
16. 流动性提供者(Liquidity Providers)
17. 逆向选择偏误(adverse selection bias)
	- "压路机前捡硬币"，这个比喻很生动形象
18. 均值方差优化模型(mean variance optimization)
19. 现代投资组合原理(modern portfolio theory, MPT) 
	- 核心含义是因为投资者本能的规避风险， 所以如果两项资产的风险程度不同但是具有同样的回报，那么投资者将会选择风险较低的资产。
20. 明订单(visible orders)/暗订单(hidden orders)
	- "冰山一角“(iceberging), 一种暗订单交易技术，即将大订单切割成许多小订单，然后投递到orderbook中
21. stop loss policy/止损策略
	- “截断亏损，让利润奔跑”
22. 凹凸度(lumpiness)
	- 该指标是回报率显著高于平均值那段时间的回报在策略总回报中所占的比例
23. 奥卡姆剃刀原理(Occam's Razor)
	- 如无必要，勿增实体 - Entities must not be multiplied beyond necessity.
24. 卖空限制列表(hard-to-borrow list)
	- 在这个单子里的股票，一般是经纪商限制做空的，可能原因是准备卖空的股票在经纪商手里并不足够多，而裸空在美国又是违法的。
25. 相互持有(cross-ownership)
26. 交叉抵押(cross-collateraling)
27. 关键时点交易(breakout trading)











