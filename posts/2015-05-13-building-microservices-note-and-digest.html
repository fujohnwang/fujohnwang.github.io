<!doctype html>
<html lang="zh"> 
 <head> 
  <meta charset="utf-8"> 
  <meta name="keywords" content="BuildingMicroservices读书笔记与感悟 - 架构教练,架构师个人成长教练,个人成长,组织成长,个人与组织成长顾问, architecture, book author, thinker, fighter, 架构, 思考, 技术, 武术, 哲学"> 
  <meta name="description" content="BuildingMicroservices读书笔记与感悟 - 扶墙老师说，王福强的个人博客， 一个架构士的思考与沉淀"> 
  <meta name="author" content="王福强"> 
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> 
  <title>BuildingMicroservices读书笔记与感悟 -王福强的个人博客：一个架构士的思考与沉淀</title> 
  <meta name="date" content="2015-05-13"> 
  <link rel="shortcut icon" href="/favicon.ico"> 
  <style type="text/css">code{white-space: pre;}</style> 
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"> 
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> 
  <script type="text/javascript" src="/js/watermark.js"></script> <!-- Bootstrap core CSS --> 
  <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet"> <!-- Custom fonts for this template --> 
  <link href="/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css"> <!-- Custom styles for this template --> 
  <link href="/css/freelancer.css" rel="stylesheet"> 
  <style type="text/css">
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      text-align: left;
      position: relative;
      -webkit-font-smoothing: antialiased;
    }
    

    h1{
      margin-top: 3rem;
    }
  </style> 
 </head> 
 <body id="page-top"> <!-- Navigation --> 
  <nav class="navbar navbar-expand-lg bg-secondary fixed-top text-uppercase" id="mainNav"> 
   <div class="container"> <a class="navbar-brand js-scroll-trigger" href="/"> <img src="/images/profile.jpeg" alt="" style="display: inline; border-radius: 50%; height: 50px;">王福强的个人博客 </a> <button class="navbar-toggler navbar-toggler-right text-uppercase bg-primary text-white rounded" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"> Menu <i class="fas fa-bars"></i> </button> 
    <div class="collapse navbar-collapse" id="navbarResponsive"> 
     <ul class="navbar-nav ml-auto"> 
      <li class="nav-item mx-0 mx-lg-1"> <a class="nav-link py-3 px-0 px-lg-3" href="/posts.html">博客文章</a> </li> 
      <li class="nav-item mx-0 mx-lg-1"> <a class="nav-link py-3 px-0 px-lg-3" href="/books.html">创作出版</a> </li> 
      <li class="nav-item mx-0 mx-lg-1"> <a class="nav-link py-3 px-0 px-lg-3" href="https://edu.afoo.me">福强AI学堂</a> </li> 
      <li class="nav-item mx-0 mx-lg-1"> <a class="nav-link py-3 px-0 px-lg-3" href="/crosslinks.html">更多链接</a> </li> 
      <li class="nav-item mx-0 mx-lg-1"> <a class="nav-link py-3 px-0 px-lg-3" href="/whoami.html">关于我</a> </li> 
      <li class="nav-item mx-0 mx-lg-1"> <a class="nav-link py-3 px-0 px-lg-3" href="/feeds.xml">RSS订阅</a> </li> 
     </ul> 
    </div> 
   </div> 
  </nav> 
  <section> 
   <div class="container"> <!--        <div class="row">--> <!--          <div class="col-lg-8 mx-auto">--> 
    <p class="lead"> </p>
    <h1 class="title">BuildingMicroservices读书笔记与感悟</h1> <small> <h3 class="author">王福强</h3> 
     <div style="text-align: left;">
      2015-05-13
     </div> </small> 
    <p></p> 
    <hr> 
    <p>loose coupling(interexchange) and high cohesion(autonomy), the most simple but long-lived rule for software development stand!!!</p> 
    <p>align service/functionality, person, team, organization, even bigger entities…</p> 
    <pre><code>bounded context  -&gt; atomic unit boundary -&gt; compositional boundaries</code></pre> 
    <blockquote> 
     <p>== Words That Make Sense In This Book ==</p> 
     <ul> 
      <li>trade short-term gain for long-term pain</li> 
      <li>Build if it’s <strong>unique</strong> to what you do.</li> 
      <li>we can make a change to a single service and deploy it independently of the rest.</li> 
     </ul> 
    </blockquote> 
    <h1 id="orchestration-vs.-choreography">Orchestration VS. Choreography</h1> 
    <p>(终于tmd理解了这两个鸟单词在软件行业里的确切意思了…)</p> 
    <p>With orchestration, we rely on a central brain to guide and drive the process, much like the conductor in an orchestra. (the coordination way)</p> 
    <p>With choreography, we inform each part of the system of its job, and let it work out the details, like dancers all finding their way and reacting to others around them in a ballet. (the fire-and-forget way)</p> 
    <p>类似于计划经济 VS. 市场经济，或者中央集权 VS. 地方自治，the former can be implemented in synchronous RPCs way, and the latter in asynchronous event-driven way.</p> 
    <h1 id="versioning">Versioning</h1> 
    <p>刚开始个人看法是， 在URI上不要明确使用version作为URI的一部分， 而采用通用的资源标志URI， 但允许通过参数来明确version， 如果不指定，则默认访问已经部署的最高版本的服务或者资源。这相当于COC的思想体现。</p> 
    <p>但后来想想，这样做（指采用默认访问latest版本服务的方式）其实存在问题， 如果客户端都采用默认不加版本的访问方式，一旦服务端升级造成不兼容， 那么客户端很大面积上会受影响。原则上，服务发布不应该影响面这么大！</p> 
    <p>所以， URI中明确version可能是更合适的方式， 由客户端或者服务访问端自己决定是否升级。</p> 
    <p>遵循一般Major.Minor.Patch的版本语意， 通常情况下， Minor版本以下的发布，对客户端来说应该是没影响的。 Major版本的发布，则可能牵扯同时存在多个版本服务实例/集群的情况。</p> 
    <p>基本原则应该是： <strong>服务不管如何升级改造， 服务的访问者有权利决定是否升级，即是否使用新版本的服务； 但服务提供者有通知的义务。</strong></p> 
    <h1 id="数据库">数据库</h1> 
    <p>最大的共享状态， 也往往是scalability最大的障碍。</p> 
    <p>本质上，如果根据实体边界将各个实体划分清晰， 状态也应该是屏蔽在实体内部， 这里唯一比较困难的一点就是， 数据库表之间的外键关系。 要达到按照实体划分清楚边界的目的， 需要打破外键（Breaking Foreign Key Relationships），由应用来管理schema之间的关系，这里的schema其实也就变成了domain实体之间的关系了。实体与实体之间（或者说服务与服务之间），各自状态内聚不外露(状态封装)， 只通过消息传递的方式进行交互。</p> 
    <h2 id="transactional-boundary">Transactional Boundary</h2> 
    <p>并非所有服务都是职能单一的，很多时候多种服务是要协同工作的，这个时候往往就需要管理事务性的服务执行，通常情况下，会再设置独立的组合性质的服务来管理跨多个服务的事务。</p> 
    <p>单数据库结点即可满足需求的服务， 事务完全可以交给数据库来管理； 一旦跳出这个能力边界， 比如跨库或者跨服务， 就需要通过其它方式来管理事务。</p> 
    <p>常见的手段有：</p> 
    <ol type="1"> 
     <li>数据补偿与订正；(the compensating/retry way)</li> 
     <li>2PC或者相似思想的分布式事务管理方式; (the orchestration way)</li> 
    </ol> 
    <p>等等。</p> 
    <h2 id="报表与数据仓库">报表与数据仓库</h2> 
    <p>如果进行服务切分，且状态随服务而行，那么，原来的基于数据同步和数据仓库的思路就会受到冲击， 相当于前端业务开发理解并研发一套系统， 后端BI人员再理解一遍，并以他们认为的形式再研发一套系统， 实际上，就后端系统的服务压力来说， 直接由前端服务统一接管并服务之应该也未尝不可，应该不像之前预想的那么恐怖吧？！</p> 
    <p>报表也好， BI其它需求也罢， 本质上是根据需求聚合并分析数据(the aggregated view of data/state)， 直接捅数据库当然最直接，但通过统一封装的服务来做这种事情也未尝不可， latency？ 应该不是核心问题吧！</p> 
    <p>另外一种思路是， 服务状态可以开放订阅，需要状态事件变更的下游系统可以直接订阅数据，汇总到自己的存储，再借助存储的支持做分析。</p> 
    <p>本质上， 还是Orchestration和Choreography两种思路的体现， 非互斥关系， 完全可以根据具体场景组合使用。</p> 
    <h1 id="deployment-artifacts">Deployment Artifacts</h1> 
    <p>制作self-contained deployable microservices as artifacts</p> 
    <h2 id="platform-specific-artifacts">Platform-Specific Artifacts</h2> 
    <p>aka. technology-specific artifacts, like gem, jar, npm, etc..</p> 
    <h2 id="operating-system-artifacts">Operating System Artifacts</h2> 
    <blockquote> 
     <p>One way to avoid the problems associated with technology-specific artifacts is to create artifacts that are native to the underlying operating system.</p> 
    </blockquote> 
    <p>say, rpm for redhat/centos, deb for debian/ubuntu, msi for windows</p> 
    <p>减少支持的操作系统类型的数量以避免无必要的资源投入。</p> 
    <p>制作自定义的Image景象，减少不必要的provisioning过程和重复（One approach to reducing this spin-up time is to create a virtual machine image that bakes in some of the common dependencies we use）。</p> 
    <p>在组织层次不足以支撑和cover新技术栈的情况下，不建议使用docker之类的容器Image技术，虽然属于发布的artifact的形式之一，但牵扯到周边系统的工作也会需要变更，包括人员，工作流程等。 “先进的，往往也是落后的”！</p> 
    <h1 id="service-to-host-mapping">Service-to-Host Mapping</h1> 
    <p>单节点部署多服务的情况，主要需要考虑资源隔离的问题。</p> 
    <p>单节点部署单一服务的情况，主要需要解决资源利用率的问题。</p> 
    <p>关注那句老话：<code>threads don't scale, processes do.</code></p> 
    <h2 id="virtualization">Virtualization</h2> 
    <blockquote> 
     <ul> 
      <li>Type 1 virtualization refers to technology where the VMs run directly on hardware, not on top of another operating system.</li> 
      <li>Type 2 virtualization, AWS, VMWare, VSphere, Xen, and KVM…</li> 
     </ul> 
    </blockquote> 
    <blockquote> 
     <p>if you don’t trust the code you are running, don’t expect that you can run it in a container and be safe. If you need that sort of isolation, you’ll need to consider using virtual machines instead.</p> 
    </blockquote> 
    <p>“After many years of working in this space, I am convinced that the most sensible way to trigger any deployment is via a single, parameterizable command-line call.”, 实际上， 命令行只是一种表现形式， 你当然可以把核心功能用shell脚本来写，但核心功能只要集中管理之后， 命令行也好， 操作页面也罢，都只是核心功能的一种延伸形式罢了。</p> 
    <h1 id="test">Test</h1> 
    <p>as long as you understand that test design and performing help you to design and implement your services/systems better, you will find the way to do the test properly.</p> 
    <p>So, I skip this section.</p> 
    <h1 id="monitoring">Monitoring</h1> 
    <p>我坚持”No News Is The Good News”原则！</p> 
    <ol type="1"> 
     <li>Alert是后继流程的起点，and <strong>Identity</strong> Matters here! 
      <ul> 
       <li>Including <code>Correlation ID</code>s</li> 
       <li>artifactId is not enough, mix everything about environment together like host, IDC, etc.</li> 
      </ul></li> 
     <li>Interconnections smooth the process!<br> </li> 
     <li>Convention and Consistency saves your ass too!</li> 
     <li>跳出单机思维， 构建平台生态圈！ 
      <ul> 
       <li>
        <blockquote> 
         <p>monitor the small things, and use aggregation to see the bigger picture.</p> 
        </blockquote></li> 
       <li>
        <blockquote> 
         <p>away from systems specialized to do just one thing, and toward generic event processing systems that allow you to look at your system in a more holistic way.</p> 
        </blockquote></li> 
       <li>logs(kibana), system metrics(dashboard which can help drill things down, like <a href="http://graphite.wikidot.com/">Graphite</a> or zabbix)， application metrics(JMX, <a href="https://github.com/dropwizard/metrics">dropwizard/metrics</a>)</li> 
      </ul></li> 
    </ol> 
    <p>实行‘计划经济’， 去他妈的‘市场经济’，这里根本不需要后者！</p> 
    <h2 id="监控的内与外">监控的内与外</h2> 
    <p>大部分情况下我们会关注身体内部的情况(各种agents，各种logs, 各种metrics，诸如此类)，但实际上，我们最好同时也对别人怎么看我们有一个起码基础的认识， 比如使用synthetic monitoring之类的手段来模拟用户访问，看看我们的提供是否正常。</p> 
    <h1 id="security">Security</h1> 
    <h2 id="authentication-authorization">Authentication &amp; Authorization</h2> 
    <p>跟哥整合挖财内网帐号体系和系统的思路相似， 偶的基本思路就是， “确定Identity， 让遵循Identity规范的系统在基本前提下根据各自情况flurish(especially, fine-grained authorization)”</p> 
    <blockquote> 
     <p>tradeoffs between Shiro and Spring Security with authorization framework.</p> 
    </blockquote> 
    <h1 id="system-design">System Design</h1> 
    <blockquote> 
     <ul> 
      <li>Any organization that designs a system (defined more broadly here than just information systems)will inevitably produce a design whose structure is a copy of the organization’s communicationstructure.</li> 
     </ul> 
    </blockquote> 
    <blockquote> 
     <ul> 
      <li>Adapting to Communication Pathways</li> 
     </ul> 
    </blockquote> 
    <p>组织结构也要“高内聚，低耦合”。</p> 
    <blockquote> 
     <p>Service Ownership</p> 
    </blockquote> 
    <p>我们实行PO制度，也是同样的道理, 职责不清，纠缠扯皮的事儿就多。</p> 
    <h1 id="工具参考">工具参考</h1> 
    <ol type="1"> 
     <li><a href="https://github.com/jordansissel/fpm/wiki">fpm - Effing Package Management</a></li> 
     <li><a href="https://www.packer.io/">Packer is a tool for creating identical machine images for multiple platforms from a single source configuration.</a></li> 
    </ol> 
    <h1 id="单词与词组学习复习">单词与词组学习/复习</h1> 
    <ol type="1"> 
     <li>inhibit, [ɪn’hɪbɪt] , v., 抑制；阻止；使不能 
      <ul> 
       <li>e.g.&nbsp;Distributed Transaction cand inhibit scaling.</li> 
       <li>区别于inhabit, v.居住于；占据；栖息</li> 
       <li>可以引申联想到prohibitive</li> 
      </ul></li> 
     <li>perilous, [’perələs], adj.危险的；冒险的 
      <ul> 
       <li>The snow and the blackout combined to make motoring perilous - 大雪加上灯火管制使得车辆行驶成了危险的事。</li> 
      </ul></li> 
     <li>lull, [lʌl], v.使安静；使入睡；哄骗；平息, n.暂停；间歇 
      <ul> 
       <li>The mother lulled the baby to sleep.</li> 
       <li>They lulled me into a false sense of security.</li> 
      </ul></li> 
    </ol> 
    <h1 id="相关文章">相关文章</h1> 
    <ol type="1"> 
     <li><a href="http://nginx.com/blog/introduction-to-microservices/">Introduction to Microservices</a></li> 
    </ol> <!--          </div>--> <!--        </div>--> 
    <hr> 
    <div> 
     <p> 「为AI疯狂」星球上，扶墙老师正在和朋友们讨论有趣的AI话题，你要不要⼀起来呀？^-^<br> 这里 </p>
     <ol> 
      <li>不但有及时新鲜的AI资讯和深度探讨</li> 
      <li>还分享AI工具、产品方法和商业机会</li> 
      <li>更有原价1000多的付费内容(近500分钟)等着你，<a href="https://t.zsxq.com/0dI3ZA0sL">加入星球(https://t.zsxq.com/0dI3ZA0sL)</a> 即可免费领取! </li> 
     </ol> 
     <p></p> <a href="https://t.zsxq.com/0dI3ZA0sL"> <img src="/posts/images/2023-05-06-12-09-53.jpg" alt="知识星球二维码"> </a> 
    </div> 
    <hr> 
    <div> <a href="/posts.html"> <b> &gt;&gt;&gt;&gt;&gt;&gt; 更多阅读 &lt;&lt;&lt;&lt;&lt;&lt; </b></a> 
    </div> 
    <div id="random_posts"> 
     <div class="alert alert-light" role="alert"> <a href="/posts/2020-10-25-saas-evolution-path.html">我对SaaS产品研发的些许观点分享 </a> 
     </div> 
     <div class="alert alert-light" role="alert"> <a href="/posts/2023-05-31-make-video-with-stable-diffusion.html">如何使用StableDiffusion与AI工具创作视频？ </a> 
     </div> 
     <div class="alert alert-light" role="alert"> <a href="/posts/2017-06-29-fuqiang-tech-gogogo.html">福强科技开始接客啦~ </a> 
     </div> 
    </div> 
    <hr> <a href="https://wfq.gumroad.com/l/fb"> <img src="/images/fb_subscribe.jpg" alt="订阅「福报Premium订阅」"> </a> 
    <div id="comments"></div> 
    <hr> 
    <div class="text-center"> <a href="https://twitter.com/fujohnwang"> <img src="/images/Twitter-logo.png" class="img-responsive" loading="lazy" style="width: fit-content;"> </a> 
    </div> 
   </div> 
  </section> 
  <div style="color:white; visibility: collapse; height: 0;">
   ©<a href="/whoami.html">王福强</a>个人版权所有, All Rights Reserved.
  </div> 
  <div class="copyright py-4 text-center text-white"> 
   <div class="container"> <small>Copyright © <a href="/whoami.html">王福强</a>个人版权所有 - Since 2004</small> 
    <br><small>Everything is homebrewed with <a href="https://pandoc.org/">pandoc</a> and <a href="https://daringfireball.net/projects/markdown/syntax">Markdown</a>, little <a href="https://www.scala-lang.org/">Scala</a> also included.</small> 
   </div> 
  </div> 
  <script type="text/javascript">
var gitalk = new Gitalk({
  clientID: '518a605d711883414ac0',
  clientSecret: '69fb8ccc0616c5bcbc64d24ece0d06d279da91ff',
  repo: 'afoo.me.comments',
  owner: 'fujohnwang',
  admin: ['fujohnwang'],
  id: location.pathname.substring(0, 49),      // Ensure uniqueness and length less than 50
  distractionFreeMode: false  // Facebook-like distraction free mode
})

gitalk.render('comments')
    </script> 
  <script src="https://storage.ko-fi.com/cdn/scripts/overlay-widget.js"></script> 
  <script>
  kofiWidgetOverlay.draw('fff000', {
    'type': 'floating-chat',
    'floating-chat.donateButton.text': 'Support me',
    'floating-chat.donateButton.background-color': 'red',
    'floating-chat.donateButton.text-color': 'white'
  });
</script> 
  <script>
  fetch('https://jsonld.afoo.me', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      url: window.location.href
    })
  }).then(response => response.text()).then(structuredDataText => {
    const script = document.createElement('script');
    script.setAttribute('type', 'application/ld+json');
    script.textContent = structuredDataText;
    document.head.appendChild(script);
  });
</script>  
  <script>watermark.init({ watermark_txt: "©王福强个人版权所有, All Rights Reserved." , watermark_width:200})</script> 
 </body>
</html>